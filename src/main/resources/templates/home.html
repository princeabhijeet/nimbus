<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nimbus | Dashboard</title>
    <link rel="stylesheet" th:href="@{/css/home.css}">
</head>
<body th:attr="data-username=${username}">
  <div th:replace="~{fragments/topbar :: topbar}"></div>

  <main class="container">
    <aside class="sidebar" aria-label="Primary">
      <nav>
        <ul>
          <li class="active"><span class="side-icon" aria-hidden="true"><svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 13h8V3H3v10zM3 21h8v-6H3v6zM13 21h8V11h-8v10zM13 3v6h8V3h-8z" fill="currentColor"/></svg></span>Dashboard</li>
        </ul>
      </nav>
    </aside>

    <section class="main-panel">
      <!-- Main dashboard content removed per request; topbar remains intact -->
      <div class="panel card">
        <div class="card-body">
          <!-- Intentionally left blank: dashboard cards removed -->
        </div>
      </div>
    </section>
  </main>

<script>
  // Only minimal client-side logic remains: set topbar username/avatar
  const SERVER_USERNAME = document.body.dataset.username || '';
  const API_PROFILE = SERVER_USERNAME ? `/nimbus/api/v1/users/username/${encodeURIComponent(SERVER_USERNAME)}` : '/nimbus/api/v1/users/me';

  // If server provided username, set topbar initial immediately to avoid default 'U' flash
  (function initTopbarFromServer(){
    try{
      const name = document.body.dataset.username || '';
      if(!name) return;
      const topAvatar = document.getElementById('topAvatar');
      const topUsername = document.getElementById('topUsername');
      const initial = name.charAt(0).toUpperCase();
      if(topUsername) topUsername.textContent = name;
      if(topAvatar){ topAvatar.textContent = initial; topAvatar.style.backgroundImage=''; topAvatar.setAttribute('aria-hidden','true'); }
    }catch(e){ /* ignore */ }
  })();

  async function fetchProfile(){
    try{
      const res = await fetch(API_PROFILE, { credentials: 'same-origin' });
      if(res.status === 401) return; // not authenticated
      if(!res.ok) throw new Error('profile fetch failed: ' + res.status);
      const data = await res.json();
      const full = [data.firstName, data.lastName].filter(Boolean).join(' ') || data.username || (data.email? data.email.split('@')[0] : 'User');
      const topUsername = document.getElementById('topUsername'); if(topUsername) topUsername.textContent = full;
      const topAvatar = document.getElementById('topAvatar');
      if(topAvatar){
        if(data.avatarUrl){ topAvatar.style.backgroundImage = `url(${data.avatarUrl})`; topAvatar.style.backgroundSize='cover'; topAvatar.textContent = ''; topAvatar.removeAttribute('aria-hidden'); }
        else { const initial = (data.firstName||data.username||'U').charAt(0).toUpperCase(); topAvatar.style.backgroundImage=''; topAvatar.textContent = initial; topAvatar.setAttribute('aria-hidden','true'); }
      }
    }catch(err){ console.warn('Unable to fetch profile', err); }
  }

  // init
  fetchProfile();
</script>
</body>
</html>

